import matplotlib.pyplot as plt
import numpy as np

# è®¾ç½®ä¸­æ–‡å­—ä½“
plt.rcParams['font.sans-serif'] = ['SimHei']
plt.rcParams['axes.unicode_minus'] = False

# æ¸¯å£/åœ°åŒº
ports = {
    "è‘µé’è´§æŸœç å¤´": (22.33465, 114.12268),
    "è¥¿åŒºå…¬ç”¨ç å¤´": (22.28833, 114.13152),
    "è¥¿åŒºå…¬ç”¨è´§ç‰©è£…å¸åŒº": (22.28165, 114.11927),
    "ä¸­ç¯ç å¤´": (22.28788, 114.15885),
    "å°–æ²™å’€ç å¤´": (22.29372, 114.16808),
    "è§‚å¡˜ç å¤´": (22.31200, 114.22600),  # æ–°å¢
    "çº¢ç£¡ç å¤´": (22.30047, 114.19501)   # æ–°å¢
}

# é¿é£å¡˜
typhoon_shelters = {
    "æ²¹éº»åœ°é¿é£å¡˜": (22.31038, 114.15698),
    "æ˜‚èˆ¹æ´²é¿é£å¡˜": (22.31200, 114.13500),
    "ä¹é¾™æ¹¾é¿é£å¡˜": (22.30300, 114.11500),
    "åŒ—è§’é¿é£å¡˜": (22.31000, 114.12700),
    "é’è¡£é¿é£å¡˜": (22.30500, 114.15000),
    "é¦™æ¸¯ä»”é¿é£å¡˜": (22.29900, 114.11800),
    "é“œé”£æ¹¾é¿é£å¡˜": (22.28250, 114.18750),
    "é²¤é±¼é—¨é¿é£å¡˜": (22.29500, 114.23800)  # æ–°å¢
}

# é”šåœ°
anchorages = {
    "è¥¿éƒ¨æ£€ç–«åŠå…¥å¢ƒé”šåœ°": (22.30762, 114.10332),
    "è¥¿éƒ¨å±é™©å“é”šåœ°": (22.31340, 114.11392),
    "åŸºåˆ—ç‰¹ 3 å·": (22.30625, 114.13038),
    "åŸºåˆ—ç‰¹ 2 å·": (22.30155, 114.12385),
    "åŸºåˆ—ç‰¹ 1 å·": (22.29885, 114.10535),
    "ä¸œéƒ¨é”šåœ°": (22.28000, 114.25000),  # æ–°å¢
    "ä¸­éƒ¨é”šåœ°": (22.29000, 114.21000)   # æ–°å¢
}

# éšœç¢ç‰©åŒºåŸŸï¼ˆå››è¾¹å½¢ï¼‰
obstacles = {
    "é’è¡£": [(22.33928, 114.08805), (22.32630, 114.09095), (22.33123, 114.11768), (22.34352, 114.11328)],
    "7å·è´§æŸœç å¤´": [(22.33543, 114.12375), (22.33698, 114.12972), (22.32847, 114.12660), (22.33068, 114.13388)],
    "æ˜‚èˆ¹æ´²": [(22.32318, 114.12230), (22.31885, 114.12933), (22.31718, 114.14320), (22.32307, 114.14653)],

    # æ–°å¢éšœç¢ç‰©ï¼ˆå››è¾¹å½¢æ ¼å¼ï¼‰
    "é’æ´²": [(22.29050, 114.13020), (22.28950, 114.13150), (22.28890, 114.13080), (22.28980, 114.12990)],
    "ä¸œåšå¯®æµ·å³¡å°å²›": [(22.28330, 114.24970), (22.28370, 114.25050), (22.28270, 114.25070), (22.28250, 114.24980)],
    "æ”¿åºœèˆ¹åªç»´ä¿®ç å¤´": [(22.31230, 114.14290), (22.31270, 114.14350), (22.31210, 114.14370), (22.31180, 114.14320)],
    "é¦™æ¸¯å›½é™…é‚®è½®ç å¤´": [(22.30200, 114.19270), (22.30240, 114.19330), (22.30160, 114.19350), (22.30120, 114.19290)],
    "æ˜‚èˆ¹æ´²å¤§æ¡¥": [(22.31640, 114.13290), (22.31690, 114.13360), (22.31610, 114.13380), (22.31570, 114.13310)],
    "è¥¿ä¹é¾™é«˜æ¶æ¡¥": [(22.31010, 114.15960), (22.31050, 114.16040), (22.30950, 114.16060), (22.30910, 114.15980)],
    "é¦™æ¸¯ä¸­åŒºæ²¹åº“": [(22.28490, 114.15460), (22.28530, 114.15540), (22.28450, 114.15560), (22.28410, 114.15480)],
    "æ˜‚èˆ¹æ´²å†›ç”¨ç å¤´": [(22.31800, 114.13960), (22.31840, 114.14040), (22.31760, 114.14060), (22.31720, 114.13980)],
    "é¦™æ¸¯å›½é™…æœºåœºæ°´åŸŸ": [(22.30800, 113.99980), (22.30840, 114.00060), (22.30760, 114.00080), (22.30720, 114.00000)],
    "æ˜‚èˆ¹æ´²å†›äº‹ç¦åŒºæ°´åŸŸ": [(22.32190, 114.13260), (22.32230, 114.13340), (22.32150, 114.13360), (22.32110, 114.13280)],
    "æ²¹éº»åœ°é¿é£å¡˜æ¸”èˆ¹åŒº": [(22.30990, 114.15710), (22.31030, 114.15790), (22.30950, 114.15810), (22.30910, 114.15730)],
    "é¦™æ¸¯ä»”é¿é£å¡˜æ¸”èˆ¹åŒº": [(22.29910, 114.11960), (22.29950, 114.12040), (22.29870, 114.12060), (22.29830, 114.11980)],
    "ä¹é¾™è¾¹ç•Œ": [
        (22.31815, 114.15420), (22.28712, 114.17587),
        (22.29633, 114.19795), (22.30300, 114.19278),
        (22.30638, 114.18612), (22.30747, 114.18247),
        (22.31118, 114.18112), (22.31815, 114.15420)
    ],
    "é¦™æ¸¯åŒ—è§’è¾¹ç•Œ": [
        (22.28453, 114.18223), (22.29343, 114.20122),
        (22.28875, 114.21612), (22.28267, 114.23058)
    ],
    "é¦™æ¸¯çŸ³å¡˜å’€è¾¹ç•Œ": [
        (22.28032, 114.11953), (22.28687, 114.13240),
        (22.28967, 114.14628), (22.28272, 114.16623),
        (22.28225, 114.17448)
    ]
}


# è¿æ¥å…³ç³» (ç å¤´ -> é¿é£å¡˜ -> é”šåœ° -> ç å¤´)
connections = [
    # ğŸ”¹ ç å¤´ -> é¿é£å¡˜
    ("ä¸­ç¯ç å¤´", "é“œé”£æ¹¾é¿é£å¡˜"),
    ("å°–æ²™å’€ç å¤´", "æ²¹éº»åœ°é¿é£å¡˜"),
    ("è§‚å¡˜ç å¤´", "é²¤é±¼é—¨é¿é£å¡˜"),
    ("çº¢ç£¡ç å¤´", "ä¹é¾™æ¹¾é¿é£å¡˜"),
    ("è‘µé’è´§æŸœç å¤´", "é’è¡£é¿é£å¡˜"),

    # ğŸ”¹ é¿é£å¡˜ - é¿é£å¡˜ï¼ˆå¢å¼ºå¯è¾¾æ€§ï¼‰
    ("æ²¹éº»åœ°é¿é£å¡˜", "æ˜‚èˆ¹æ´²é¿é£å¡˜"),
    ("ä¹é¾™æ¹¾é¿é£å¡˜", "é²¤é±¼é—¨é¿é£å¡˜"),
    ("é“œé”£æ¹¾é¿é£å¡˜", "åŒ—è§’é¿é£å¡˜"),
    ("é²¤é±¼é—¨é¿é£å¡˜", "ä¸œéƒ¨é”šåœ°"),
    ("ä¹é¾™æ¹¾é¿é£å¡˜", "æ˜‚èˆ¹æ´²é¿é£å¡˜"),
    ("æ²¹éº»åœ°é¿é£å¡˜", "åŒ—è§’é¿é£å¡˜"),
    ("é’è¡£é¿é£å¡˜", "æ˜‚èˆ¹æ´²é¿é£å¡˜"),
    ("åŒ—è§’é¿é£å¡˜", "æ˜‚èˆ¹æ´²é¿é£å¡˜"),
    ("åŒ—è§’é¿é£å¡˜", "æ²¹éº»åœ°é¿é£å¡˜"),
    ("é²¤é±¼é—¨é¿é£å¡˜", "ä¹é¾™æ¹¾é¿é£å¡˜"),  # âœ… æ–°å¢

    # ğŸ”¹ é¿é£å¡˜ - é”šåœ°ï¼ˆå¿…è¦æ—¶å¿…é¡»ç»è¿‡é”šåœ°ï¼‰
    ("æ²¹éº»åœ°é¿é£å¡˜", "è¥¿éƒ¨æ£€ç–«åŠå…¥å¢ƒé”šåœ°"),
    ("é²¤é±¼é—¨é¿é£å¡˜", "ä¸œéƒ¨é”šåœ°"),
    ("ä¹é¾™æ¹¾é¿é£å¡˜", "åŸºåˆ—ç‰¹ 1 å·"),
    ("ä¹é¾™æ¹¾é¿é£å¡˜", "ä¸­éƒ¨é”šåœ°"),
    ("é’è¡£é¿é£å¡˜", "åŸºåˆ—ç‰¹ 3 å·"),
    ("é“œé”£æ¹¾é¿é£å¡˜", "åŸºåˆ—ç‰¹ 2 å·"),
    ("ä¹é¾™æ¹¾é¿é£å¡˜", "è¥¿éƒ¨æ£€ç–«åŠå…¥å¢ƒé”šåœ°"),
    ("ä¸œéƒ¨é”šåœ°", "åŸºåˆ—ç‰¹ 1 å·"),  # âœ… æ–°å¢

    # ğŸ”¹ é”šåœ° - é”šåœ°ï¼ˆå¼ºåŒ–é”šåœ°é—´è¿æ¥ï¼‰
    ("è¥¿éƒ¨æ£€ç–«åŠå…¥å¢ƒé”šåœ°", "è¥¿éƒ¨å±é™©å“é”šåœ°"),
    ("è¥¿éƒ¨æ£€ç–«åŠå…¥å¢ƒé”šåœ°", "åŸºåˆ—ç‰¹ 3 å·"),
    ("ä¸œéƒ¨é”šåœ°", "ä¸­éƒ¨é”šåœ°"),
    ("åŸºåˆ—ç‰¹ 3 å·", "åŸºåˆ—ç‰¹ 2 å·"),
    ("åŸºåˆ—ç‰¹ 2 å·", "åŸºåˆ—ç‰¹ 1 å·"),
    ("è¥¿éƒ¨å±é™©å“é”šåœ°", "åŸºåˆ—ç‰¹ 1 å·"),
    ("ä¸­éƒ¨é”šåœ°", "åŸºåˆ—ç‰¹ 2 å·"),
    ("è¥¿éƒ¨å±é™©å“é”šåœ°", "åŸºåˆ—ç‰¹ 3 å·"),

    # ğŸ”¹ é”šåœ° - ç å¤´ï¼ˆéƒ¨åˆ†æ¸¯å£å¯ç»ç”±é”šåœ°ï¼‰
    ("è¥¿éƒ¨æ£€ç–«åŠå…¥å¢ƒé”šåœ°", "ä¸­ç¯ç å¤´"),
    ("ä¸œéƒ¨é”šåœ°", "è§‚å¡˜ç å¤´"),
    ("åŸºåˆ—ç‰¹ 1 å·", "çº¢ç£¡ç å¤´"),
    ("åŸºåˆ—ç‰¹ 3 å·", "å°–æ²™å’€ç å¤´"),
    ("è§‚å¡˜ç å¤´", "ä¸­éƒ¨é”šåœ°"),  # âœ… æ–°å¢

    # ğŸ”¹ é¢å¤–ä¼˜åŒ–è¿æ¥ï¼ˆé˜²æ­¢å­¤ç«‹ç‚¹ï¼‰
    ("è¥¿åŒºå…¬ç”¨ç å¤´", "è¥¿éƒ¨æ£€ç–«åŠå…¥å¢ƒé”šåœ°"),
    ("è¥¿åŒºå…¬ç”¨è´§ç‰©è£…å¸åŒº", "åŸºåˆ—ç‰¹ 3 å·"),  # âœ… æ›¿æ¢åŸç›´è¿
    ("è‘µé’è´§æŸœç å¤´", "è¥¿éƒ¨æ£€ç–«åŠå…¥å¢ƒé”šåœ°"),
    ("å°–æ²™å’€ç å¤´", "åŸºåˆ—ç‰¹ 2 å·")
]

# ç»˜åˆ¶åœ°å›¾
def plot_map():
    plt.figure(figsize=(12, 10))

    # å–æ¶ˆç§‘å­¦è®¡æ•°æ³•
    plt.ticklabel_format(style='plain', axis='both')

    # è®¾ç½®åœ°å›¾èŒƒå›´
    plt.xlim(114.08, 114.26)
    plt.ylim(22.28, 22.35)

    # ç»˜åˆ¶æ¸¯å£/åœ°åŒº
    for name, (lat, lon) in ports.items():
        plt.scatter(lon, lat, c='blue', marker='o', label='æ¸¯å£/åœ°åŒº' if name == list(ports.keys())[0] else "")
        plt.annotate(name, xy=(lon, lat), xytext=(lon + 0.005, lat + 0.002), fontsize=9,
                     arrowprops=dict(facecolor='blue', arrowstyle='->'),
                     bbox=dict(facecolor='white', alpha=0.7, edgecolor='none'))

    # ç»˜åˆ¶é¿é£å¡˜
    for name, (lat, lon) in typhoon_shelters.items():
        plt.scatter(lon, lat, c='green', marker='s', label='é¿é£å¡˜' if name == list(typhoon_shelters.keys())[0] else "")
        plt.annotate(name, xy=(lon, lat), xytext=(lon + 0.005, lat + 0.002), fontsize=9,
                     arrowprops=dict(facecolor='green', arrowstyle='->'),
                     bbox=dict(facecolor='white', alpha=0.7, edgecolor='none'))

    # ç»˜åˆ¶é”šåœ°
    for name, (lat, lon) in anchorages.items():
        plt.scatter(lon, lat, c='orange', marker='^', label='é”šåœ°' if name == list(anchorages.keys())[0] else "")
        plt.annotate(name, xy=(lon, lat), xytext=(lon + 0.005, lat + 0.002), fontsize=9,
                     arrowprops=dict(facecolor='orange', arrowstyle='->'),
                     bbox=dict(facecolor='white', alpha=0.7, edgecolor='none'))

    # ç»˜åˆ¶è¿æ¥å…³ç³»ï¼ˆè™šçº¿ï¼‰
    for start, end in connections:
        if start in ports:
            color = 'blue'
        elif start in typhoon_shelters:
            color = 'green'
        elif start in anchorages:
            color = 'orange'
        else:
            color = 'black'

        lat1, lon1 = ports.get(start, typhoon_shelters.get(start, anchorages.get(start)))
        lat2, lon2 = ports.get(end, typhoon_shelters.get(end, anchorages.get(end)))
        plt.plot([lon1, lon2], [lat1, lat2], linestyle='dashed', color=color, alpha=0.6)

    # ç»˜åˆ¶éšœç¢ç‰©åŒºåŸŸï¼ˆçº¢è‰²å¤šè¾¹å½¢ï¼‰
    for name, points in obstacles.items():
        latitudes, longitudes = zip(*points)
        latitudes += (latitudes[0],)  # é—­åˆå¤šè¾¹å½¢
        longitudes += (longitudes[0],)

        plt.plot(longitudes, latitudes, linestyle='solid', color='red', alpha=0.7, linewidth=2)
        plt.fill(longitudes, latitudes, color='red', alpha=0.3)

        # è®¡ç®—éšœç¢ç‰©ä¸­å¿ƒç‚¹å¹¶æ·»åŠ æ³¨é‡Š
        center_lat, center_lon = np.mean(latitudes), np.mean(longitudes)
        plt.annotate(name, xy=(center_lon, center_lat), xytext=(center_lon + 0.005, center_lat + 0.002),
                     fontsize=9, arrowprops=dict(facecolor='red', arrowstyle='->'),
                     bbox=dict(facecolor='white', alpha=0.7, edgecolor='none'))

    # åœ¨å›¾ä¾‹ä¸­æ·»åŠ çº¢è‰²éšœç¢ç‰©æ ‡æ³¨
    plt.scatter([], [], color='red', label='éšœç¢ç‰©åŒºåŸŸ')  # ç”¨ç©ºçš„æ•£ç‚¹å›¾æ¥æ·»åŠ å›¾ä¾‹æ ‡ç­¾

    plt.xlabel("ç»åº¦")
    plt.ylabel("çº¬åº¦")
    plt.title("æ— äººè‰‡è·¯å¾„è§„åˆ’ - é¿é£å¡˜ & é”šåœ° & åœ°åŒº & éšœç¢ç‰©")
    plt.legend()
    plt.grid()
    plt.show()


# è¿è¡Œåœ°å›¾ç»˜åˆ¶
plot_map()
