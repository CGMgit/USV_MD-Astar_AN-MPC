import numpy as np
import pandas as pd

# ---------------- 1️⃣ 经纬度转换为平面坐标 ----------------
# 参考点（左下角作为原点）
LAT_ORIGIN = 22.28000  # 纬度
LON_ORIGIN = 114.00000  # 经度

# 地球半径 (单位: m)
R = 6371000

# 经纬度转米的转换函数
def latlon_to_xy(lat1, lon1):
    """ 将经纬度转换为相对于 (LAT_ORIGIN, LON_ORIGIN) 的平面坐标（米） """
    x1 = (lon1 - LON_ORIGIN) * (np.pi / 180) * R * np.cos(np.radians(LAT_ORIGIN))
    y1 = (lat1 - LAT_ORIGIN) * (np.pi / 180) * R
    return round(x1, 3), round(y1, 3)

# ---------------- 2️⃣ 定义所有的坐标数据 ----------------
# 港口/地区
ports = {
    "葵青货柜码头": (22.33465, 114.12268),
    "西区公用码头": (22.28833, 114.13152),
    "西区公用货物装卸区": (22.28165, 114.11927),
    "中环码头": (22.28788, 114.15885),
    "尖沙咀码头": (22.29372, 114.16808),
    "观塘码头": (22.31200, 114.22600),
    "红磡码头": (22.30047, 114.19501)
}

# 避风塘
typhoon_shelters = {
    "油麻地避风塘": (22.31038, 114.15698),
    "昂船洲避风塘": (22.31200, 114.13500),
    "九龙湾避风塘": (22.30300, 114.11500),
    "北角避风塘": (22.31000, 114.12700),
    "青衣避风塘": (22.30500, 114.15000),
    "香港仔避风塘": (22.29900, 114.11800),
    "铜锣湾避风塘": (22.28250, 114.18750),
    "鲤鱼门避风塘": (22.29500, 114.23800)
}

# 锚地
anchorages = {
    "西部检疫及入境锚地": (22.30762, 114.10332),
    "西部危险品锚地": (22.31340, 114.11392),
    "基列特 3 号": (22.30625, 114.13038),
    "基列特 2 号": (22.30155, 114.12385),
    "基列特 1 号": (22.29885, 114.10535),
    "东部锚地": (22.28000, 114.25000),
    "中部锚地": (22.29000, 114.21000)
}

# 障碍物区域（四边形）
obstacles = {
    "青衣": [(22.33928, 114.08805), (22.32630, 114.09095), (22.33123, 114.11768), (22.34352, 114.11328)],
    "7号货柜码头": [(22.33543, 114.12375), (22.33698, 114.12972), (22.32847, 114.12660), (22.33068, 114.13388)],
    "昂船洲": [(22.32318, 114.12230), (22.31885, 114.12933), (22.31718, 114.14320), (22.32307, 114.14653)],

    # 新增障碍物（四边形格式）
    "青洲": [(22.29050, 114.13020), (22.28950, 114.13150), (22.28890, 114.13080), (22.28980, 114.12990)],
    "东博寮海峡小岛": [(22.28330, 114.24970), (22.28370, 114.25050), (22.28270, 114.25070), (22.28250, 114.24980)],
    "政府船只维修码头": [(22.31230, 114.14290), (22.31270, 114.14350), (22.31210, 114.14370), (22.31180, 114.14320)],
    "香港国际邮轮码头": [(22.30200, 114.19270), (22.30240, 114.19330), (22.30160, 114.19350), (22.30120, 114.19290)],
    "昂船洲大桥": [(22.31640, 114.13290), (22.31690, 114.13360), (22.31610, 114.13380), (22.31570, 114.13310)],
    "西九龙高架桥": [(22.31010, 114.15960), (22.31050, 114.16040), (22.30950, 114.16060), (22.30910, 114.15980)],
    "香港中区油库": [(22.28490, 114.15460), (22.28530, 114.15540), (22.28450, 114.15560), (22.28410, 114.15480)],
    "昂船洲军用码头": [(22.31800, 114.13960), (22.31840, 114.14040), (22.31760, 114.14060), (22.31720, 114.13980)],
    "香港国际机场水域": [(22.30800, 113.99980), (22.30840, 114.00060), (22.30760, 114.00080), (22.30720, 114.00000)],
    "昂船洲军事禁区水域": [(22.32190, 114.13260), (22.32230, 114.13340), (22.32150, 114.13360), (22.32110, 114.13280)],
    "油麻地避风塘渔船区": [(22.30990, 114.15710), (22.31030, 114.15790), (22.30950, 114.15810), (22.30910, 114.15730)],
    "香港仔避风塘渔船区": [(22.29910, 114.11960), (22.29950, 114.12040), (22.29870, 114.12060), (22.29830, 114.11980)],
    "九龙边界": [
        (22.31815, 114.15420), (22.28712, 114.17587),
        (22.29633, 114.19795), (22.30300, 114.19278),
        (22.30638, 114.18612), (22.30747, 114.18247),
        (22.31118, 114.18112), (22.31815, 114.15420)
    ],
    "香港北角边界": [
        (22.28453, 114.18223), (22.29343, 114.20122),
        (22.28875, 114.21612), (22.28267, 114.23058)
    ],
    "香港石塘咀边界": [
        (22.28032, 114.11953), (22.28687, 114.13240),
        (22.28967, 114.14628), (22.28272, 114.16623),
        (22.28225, 114.17448)
    ]
}

# ---------------- 3️⃣ 转换所有坐标 ----------------
# 转换单点数据（港口、避风塘、锚地）
converted_points = []
for category, data in [("港口", ports), ("避风塘", typhoon_shelters), ("锚地", anchorages)]:
    for name, (lat, lon) in data.items():
        x, y = latlon_to_xy(lat, lon)
        converted_points.append({"类别": category, "名称": name, "X (m)": x, "Y (m)": y})

# 转换障碍物数据（四边形）
converted_obstacles = []
for obstacle_name, points in obstacles.items():
    for i, (lat, lon) in enumerate(points, start=1):
        x, y = latlon_to_xy(lat, lon)
        converted_obstacles.append({"障碍物": obstacle_name, "点编号": i, "X (m)": x, "Y (m)": y})

# ---------------- 4️⃣ 生成数据表 ----------------
# 创建 DataFrame
df_points = pd.DataFrame(converted_points)
df_obstacles = pd.DataFrame(converted_obstacles)

# 保存为 CSV 文件
df_points.to_csv("converted_points.csv", index=False, encoding="utf-8-sig")
df_obstacles.to_csv("converted_obstacles.csv", index=False, encoding="utf-8-sig")

# 输出转换结果
print("===== 坐标转换完成 =====")
print("✅ 港口/避风塘/锚地坐标已保存至 converted_points.csv")
print("✅ 障碍物坐标已保存至 converted_obstacles.csv")
